"use strict";
function formatDate(date) {
    var ret = date.getFullYear().toString() + ("00" + (date.getMonth() + 1).toString()).slice(-2) + ("00" + (date.getDate()).toString()).slice(-2);
    return ret;
}
function formatTime(date) {
    var ret = ("00" + date.getHours().toString()).slice(-2) + ("00" + date.getMinutes().toString()).slice(-2) + ("00" + date.getSeconds().toString()).slice(-2);
    return ret;
}
function prettytrace(session, event, localParams) {
    var log = session.log;
    var now = new Date();
    var logDate = formatDate(now);
    var logTime = formatTime(now);
    try {
        if (session["fsm-trace-level"] > 0) {
            if (event["event-additional-info"] != null) {
                session["trace-skey"] = event["event-additional-info"]["tracingid"];
                session["trace-type"] = logDate + "-" + logTime + "_" + event["event-additional-info"]["tracingmsg"];
            }
            else {
                session["trace-type"] = logDate + "-" + logTime + "_MissingStagingInfo";
            }
            if (session["trace-type"] == "random") {
                session["fsm-trace-level"] = 2;
            }
            else {
                session["fsm-trace-level"] = 2;
            }
        }
    }
    catch (e) {
        log.error("get_checkHF:Error adding trace details: {}", e);
    }
}
;
;
function get_checkHF(session, event, localParams) {
    var ret;
    ret = ret || {};
    ret.resultCode = "success";
    var log = session.log;
    try {
        var now = new Date();
        var logDate = formatDate(now);
        var logTime = formatTime(now);
        try {
            if (session["fsm-trace-level"] > 0) {
                if (event["event-additional-info"] != null) {
                    session["trace-skey"] = event["event-additional-info"]["tracingid"];
                    session["trace-type"] = logDate + "-" + logTime + "_" + event["event-additional-info"]["tracingmsg"];
                }
                else {
                    session["trace-type"] = logDate + "-" + logTime + "_MissingStagingInfo";
                }
                if (session["trace-type"] == "random") {
                    session["fsm-trace-level"] = 2;
                }
                else {
                    session["fsm-trace-level"] = 2;
                }
            }
        }
        catch (e) {
            log.error("get_checkHF:Error adding trace details: {}", e);
        }
        session.s_InitialInvite = event;
        session.s_IncCapabilities = session.s_InitialInvite.SIP.capabilities;
        session.s_RequestURI = session.s_InitialInvite.SIP["R-URI"];
        session.s_ContextID = session.s_RequestURI.address.uri.number;
        if (session.s_InitialInvite.SIP["P-Asserted-Identity"] != null) {
            if (session.s_InitialInvite.SIP["P-Asserted-Identity"][0].address.uri.number != null) {
                session.s_pai = session.s_InitialInvite.SIP["P-Asserted-Identity"][0].address.uri.number;
            }
            else {
                if (session.s_InitialInvite.SIP["P-Asserted-Identity"][0].address.uri.user != null) {
                    session.s_pai = session.s_InitialInvite.SIP["P-Asserted-Identity"][0].address.uri.user;
                }
            }
        }
        if (session.s_InitialInvite.SIP["From"] != null) {
            if (session.s_InitialInvite.SIP["From"].address.uri.number != null) {
                session.s_from = session.s_InitialInvite.SIP["From"].address.uri.number;
            }
            else {
                if (session.s_InitialInvite.SIP["From"].address.uri.user != null) {
                    session.s_from = session.s_InitialInvite.SIP["From"].address.uri.user;
                }
            }
        }
        if (session.s_InitialInvite.SIP["Privacy"] != null) {
            if (session.s_InitialInvite.SIP["Privacy"].value != null) {
                session.s_privacy = session.s_InitialInvite.SIP["Privacy"].value;
            }
        }
        return ret;
    }
    catch (e) {
        return "Error";
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kdWxlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibW9kdWxlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFFQSxTQUFTLFVBQVUsQ0FBQyxJQUFXO0lBQzNCLElBQUksR0FBRyxHQUFhLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQyxRQUFRLEVBQUUsR0FBRyxDQUFDLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsR0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxHQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNySixPQUFPLEdBQUcsQ0FBQztBQUNmLENBQUM7QUFFRCxTQUFTLFVBQVUsQ0FBQyxJQUFXO0lBQzNCLElBQUksR0FBRyxHQUFhLENBQUMsSUFBSSxHQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxHQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxHQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2hLLE9BQU8sR0FBRyxDQUFDO0FBQ2YsQ0FBQztBQUdELFNBQVMsV0FBVyxDQUFDLE9BQVcsRUFBQyxLQUFTLEVBQUMsV0FBZTtJQUN0RCxJQUFJLEdBQUcsR0FBUyxPQUFPLENBQUMsR0FBRyxDQUFDO0lBRzVCLElBQUksR0FBRyxHQUFVLElBQUksSUFBSSxFQUFFLENBQUM7SUFD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QyxlQUFlLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDO2FBRTNFO2lCQUFNO2dCQUVOLElBQUksT0FBTyxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLElBQUksSUFBSSxFQUFFO29CQUVqRSxPQUFPLENBQUMsTUFBTSxHQUFHLE9BQU8sQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDO2lCQUV0RTthQUNGO1NBQ0g7UUFFRCxJQUFHLE9BQU8sQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxJQUFJLElBQUksRUFBRTtZQUUvQyxJQUFJLE9BQU8sQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFDLEtBQUssSUFBSSxJQUFJLEVBQUU7Z0JBRXRELE9BQU8sQ0FBQyxTQUFTLEdBQUcsT0FBTyxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUMsS0FBSyxDQUFDO2FBRXBFO1NBQ0o7UUFDRCxPQUFPLEdBQUcsQ0FBQztLQUVWO0lBQUMsT0FBTyxDQUFDLEVBQUU7UUFFUixPQUFPLE9BQU8sQ0FBQztLQUVsQjtBQUNMLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiogbGliIGNvZGUgKi9cblxuZnVuY3Rpb24gZm9ybWF0RGF0ZShkYXRlIDogRGF0ZSkgOiBzdHJpbmcge1xuICAgIGxldCByZXQgOiBzdHJpbmcgID0gZGF0ZS5nZXRGdWxsWWVhcigpLnRvU3RyaW5nKCkgKyAoXCIwMFwiICsgKGRhdGUuZ2V0TW9udGgoKSsxKS50b1N0cmluZygpKS5zbGljZSgtMikgKyAoXCIwMFwiKyhkYXRlLmdldERhdGUoKSkudG9TdHJpbmcoKSkuc2xpY2UoLTIpO1xuICAgIHJldHVybiByZXQ7XG59XG5cbmZ1bmN0aW9uIGZvcm1hdFRpbWUoZGF0ZSA6IERhdGUpIDogc3RyaW5nIHtcbiAgICBsZXQgcmV0IDogc3RyaW5nICA9IChcIjAwXCIrZGF0ZS5nZXRIb3VycygpLnRvU3RyaW5nKCkpLnNsaWNlKC0yKSArIChcIjAwXCIrZGF0ZS5nZXRNaW51dGVzKCkudG9TdHJpbmcoKSkuc2xpY2UoLTIpICsgKFwiMDBcIitkYXRlLmdldFNlY29uZHMoKS50b1N0cmluZygpKS5zbGljZSgtMik7XG4gICAgcmV0dXJuIHJldDtcbn1cblxuXG5mdW5jdGlvbiBwcmV0dHl0cmFjZShzZXNzaW9uOmFueSxldmVudDphbnksbG9jYWxQYXJhbXM6YW55KTogYW55IHtcbiAgICBsZXQgbG9nIDogYW55ID0gc2Vzc2lvbi5sb2c7XG4gICAgXG4gICAgLy9zZXQgcHJldHR5IHRyYWNpbmcgaW5mby4gVGhpcyBzaGFsbCBiZSBpbiB0aGUgZmlyc3QgbGlicmFyeSBhZnRlciBtYWluXG4gICAgbGV0IG5vdyA6IERhdGUgPSBuZXcgRGF0ZSgpO1xuICAgIGxldCBsb2dEYXRlIDogc3RyaW5nID0gZm9ybWF0RGF0ZShub3cpO1xuICAgIGxldCBsb2dUaW1lIDogc3RyaW5nID0gZm9ybWF0VGltZShub3cpO1xuICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAoc2Vzc2lvbltcImZzbS10cmFjZS1sZXZlbFwiXSA+IDApIHtcbiAgICAgICAgICAgICAgICAvL29ubHkgaW5jcmVhc2UgdHJhY2UgaWYgZW5hYmxlZCBieSBTdGFydCBoYW5kbGVyIChyYW5kb20gb3IgbGlzdCBiYXNlZClcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnRbXCJldmVudC1hZGRpdGlvbmFsLWluZm9cIl0hPW51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbltcInRyYWNlLXNrZXlcIl0gPSBldmVudFtcImV2ZW50LWFkZGl0aW9uYWwtaW5mb1wiXVtcInRyYWNpbmdpZFwiXTtcbiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbltcInRyYWNlLXR5cGVcIl0gPSBsb2dEYXRlK1wiLVwiKyBsb2dUaW1lK1wiX1wiK2V2ZW50W1wiZXZlbnQtYWRkaXRpb25hbC1pbmZvXCJdW1widHJhY2luZ21zZ1wiXTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgIHtcbiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbltcInRyYWNlLXR5cGVcIl0gPSBsb2dEYXRlK1wiLVwiKyBsb2dUaW1lK1wiX01pc3NpbmdTdGFnaW5nSW5mb1wiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoc2Vzc2lvbltcInRyYWNlLXR5cGVcIl0gPT0gXCJyYW5kb21cIikge1xuICAgICAgICAgICAgICAgICAgICAvL3RoaXMgaXMgYSByYW5kb20gdHJhY2UgLSBzZXQgdGhlIHZhbHVlIGZyb20gZGVmYXVsdCAxIHRvIDIuIG5vdCBwb3NzaWJsZSB0byBnZXQgaXQgZnJvbSBVSVIgYXMgdGhpcyBpcyBsYXRlciBpbiB0aGUgZmxvdy4gbWF5YmUgY291bGQgY2hhbmdlIGluIGxhdGVyIGJ1dCBub3QgY29uc2lkZXJlZCB5ZXRcbiAgICAgICAgICAgICAgICAgICAgLy9cImZzbS10cmFjZS1sZXZlbFwiIGZpZWxkIGluIHRoZSBzZXNzaW9uIHRvIGVpdGhlciAwIChiYXNpYyksIDEgKGludGVybWVkaWF0ZSkgb3IgMiAoaGlnaCk7XG4gICAgICAgICAgICAgICAgICAgIHNlc3Npb25bXCJmc20tdHJhY2UtbGV2ZWxcIl0gPSAyO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNlc3Npb25bXCJmc20tdHJhY2UtbGV2ZWxcIl0gPSAyO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGxvZy5lcnJvcihcImdldF9jaGVja0hGOkVycm9yIGFkZGluZyB0cmFjZSBkZXRhaWxzOiB7fVwiLGUpO1xuICAgIH1cbn1cblxuOy8vTUFJTkJMT0NLXG47ZnVuY3Rpb24gZ2V0X2NoZWNrSEYoc2Vzc2lvbjphbnksZXZlbnQ6YW55LGxvY2FsUGFyYW1zOmFueSk6IGFueSB7XG4gICAgLy9EZWZpbmUgZGVmYXVsdCByZXN1bHQgY29kZSAmIGxvZ2dpbmdcbiAgICBsZXQgcmV0OiBSZXN1bHRDb2RlO1xuICAgIHJldCA9IHJldCB8fCB7fTtcbiAgICByZXQucmVzdWx0Q29kZT1cInN1Y2Nlc3NcIjtcbiAgICBsZXQgbG9nIDogYW55ID0gc2Vzc2lvbi5sb2c7XG5cblxuICAgIHRyeSB7XG5cblxuICAgICAgICAvL2FkZCBwcmV0dHl0cmFjZSBkaXJlY3RseSBpbnRvIHRoZSBmaXJzdCBmdW5jdGlvblxuICAgICAgICAvL3RoaXMgc2V0cyB0aGUgcGFyYW1ldGVycyB0aGF0IHNob3cgdXAgYXQgdGhlIHRyYWNlIGd1aVxuICAgICAgICBsZXQgbm93IDogRGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGxldCBsb2dEYXRlIDogc3RyaW5nID0gZm9ybWF0RGF0ZShub3cpO1xuICAgICAgICBsZXQgbG9nVGltZSA6IHN0cmluZyA9IGZvcm1hdFRpbWUobm93KTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBpZiAoc2Vzc2lvbltcImZzbS10cmFjZS1sZXZlbFwiXSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgLy9vbmx5IGluY3JlYXNlIHRyYWNlIGlmIGVuYWJsZWQgYnkgU3RhcnQgaGFuZGxlciAocmFuZG9tIG9yIGxpc3QgYmFzZWQpXG4gICAgICAgICAgICAgICAgICAgIGlmIChldmVudFtcImV2ZW50LWFkZGl0aW9uYWwtaW5mb1wiXSE9bnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbltcInRyYWNlLXNrZXlcIl0gPSBldmVudFtcImV2ZW50LWFkZGl0aW9uYWwtaW5mb1wiXVtcInRyYWNpbmdpZFwiXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb25bXCJ0cmFjZS10eXBlXCJdID0gbG9nRGF0ZStcIi1cIisgbG9nVGltZStcIl9cIitldmVudFtcImV2ZW50LWFkZGl0aW9uYWwtaW5mb1wiXVtcInRyYWNpbmdtc2dcIl07XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSAge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbltcInRyYWNlLXR5cGVcIl0gPSBsb2dEYXRlK1wiLVwiKyBsb2dUaW1lK1wiX01pc3NpbmdTdGFnaW5nSW5mb1wiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChzZXNzaW9uW1widHJhY2UtdHlwZVwiXSA9PSBcInJhbmRvbVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL3RoaXMgaXMgYSByYW5kb20gdHJhY2UgLSBzZXQgdGhlIHZhbHVlIGZyb20gZGVmYXVsdCAxIHRvIDIuIG5vdCBwb3NzaWJsZSB0byBnZXQgaXQgZnJvbSBVSVIgYXMgdGhpcyBpcyBsYXRlciBpbiB0aGUgZmxvdy4gbWF5YmUgY291bGQgY2hhbmdlIGluIGxhdGVyIGJ1dCBub3QgY29uc2lkZXJlZCB5ZXRcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vXCJmc20tdHJhY2UtbGV2ZWxcIiBmaWVsZCBpbiB0aGUgc2Vzc2lvbiB0byBlaXRoZXIgMCAoYmFzaWMpLCAxIChpbnRlcm1lZGlhdGUpIG9yIDIgKGhpZ2gpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbltcImZzbS10cmFjZS1sZXZlbFwiXSA9IDI7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uW1wiZnNtLXRyYWNlLWxldmVsXCJdID0gMjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgbG9nLmVycm9yKFwiZ2V0X2NoZWNrSEY6RXJyb3IgYWRkaW5nIHRyYWNlIGRldGFpbHM6IHt9XCIsZSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL1N0b3JlIGluY29taW5nIGluaXRpYWwgU0lQIEludml0ZSBmcm9tIG5ldHdvcmsgKHVzZWQgZm9yIHNlbmQgSW52aXRlcyAmIHJlc3BvbnNlcylcbiAgICAgICAgc2Vzc2lvbi5zX0luaXRpYWxJbnZpdGUgPSBldmVudDtcbiAgICAgICAgLy9HZXQgdGhlIGNhcGFiaWxpdGllcyBvZiBVQSBmcm9tIGluaXRpYWwgSW52aXRlIGZyb20gTmV0d29yayBmb3IgbGF0ZXIgdXNlIGFuZCBtYW5pcHVsYXRpb25cbiAgICAgICAgc2Vzc2lvbi5zX0luY0NhcGFiaWxpdGllcyA9IHNlc3Npb24uc19Jbml0aWFsSW52aXRlLlNJUC5jYXBhYmlsaXRpZXM7XG5cbiAgICAgICAgLy9HZXQgdGhlIFJlcXVlc3QgVVJJIGluIHRlbCBmb3JtYXQgd2hpY2ggY29udGFpbnMgQ29udGV4dC1JRCAoTGFzdCA3IGRpZ2l0cykgY3JlYXRlZCBieSBDYW1lbCBJUlMgcGFydCBlLmcuOiA0MzY2MDA2Njk4NjIzMlxuICAgICAgICAvL1ByZWZpeDogNDM2NjAwNiBcbiAgICAgICAgLy9Db250ZXh0IElEOiA2OTg2MjMyXG4gICAgICAgIHNlc3Npb24uc19SZXF1ZXN0VVJJID0gc2Vzc2lvbi5zX0luaXRpYWxJbnZpdGUuU0lQW1wiUi1VUklcIl07XG4gICAgICAgIHNlc3Npb24uc19Db250ZXh0SUQgPSBzZXNzaW9uLnNfUmVxdWVzdFVSSS5hZGRyZXNzLnVyaS5udW1iZXI7XG4gICAgICAgIFxuICAgICBpZihzZXNzaW9uLnNfSW5pdGlhbEludml0ZS5TSVBbXCJQLUFzc2VydGVkLUlkZW50aXR5XCJdICE9IG51bGwpIHtcblxuICAgICAgICBpZiAoc2Vzc2lvbi5zX0luaXRpYWxJbnZpdGUuU0lQW1wiUC1Bc3NlcnRlZC1JZGVudGl0eVwiXVswXS5hZGRyZXNzLnVyaS5udW1iZXIgIT0gbnVsbCkge1xuXG4gICAgICAgICAgICBzZXNzaW9uLnNfcGFpID0gc2Vzc2lvbi5zX0luaXRpYWxJbnZpdGUuU0lQW1wiUC1Bc3NlcnRlZC1JZGVudGl0eVwiXVswXS5hZGRyZXNzLnVyaS5udW1iZXI7XG5cbiAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgaWYgKHNlc3Npb24uc19Jbml0aWFsSW52aXRlLlNJUFtcIlAtQXNzZXJ0ZWQtSWRlbnRpdHlcIl1bMF0uYWRkcmVzcy51cmkudXNlciAhPSBudWxsKSB7XG5cbiAgICAgICAgICBzZXNzaW9uLnNfcGFpID0gc2Vzc2lvbi5zX0luaXRpYWxJbnZpdGUuU0lQW1wiUC1Bc3NlcnRlZC1JZGVudGl0eVwiXVswXS5hZGRyZXNzLnVyaS51c2VyOyAgXG5cbiAgICAgICAgIH0gICAgXG4gICAgICAgIH1cbiAgICAgfVxuICAgICAgICBcbiAgICBpZihzZXNzaW9uLnNfSW5pdGlhbEludml0ZS5TSVBbXCJGcm9tXCJdICE9IG51bGwpIHtcblxuICAgICAgICBpZiAoc2Vzc2lvbi5zX0luaXRpYWxJbnZpdGUuU0lQW1wiRnJvbVwiXS5hZGRyZXNzLnVyaS5udW1iZXIgIT0gbnVsbCkge1xuXG4gICAgICAgICAgICBzZXNzaW9uLnNfZnJvbSA9IHNlc3Npb24uc19Jbml0aWFsSW52aXRlLlNJUFtcIkZyb21cIl0uYWRkcmVzcy51cmkubnVtYmVyO1xuXG4gICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgIGlmIChzZXNzaW9uLnNfSW5pdGlhbEludml0ZS5TSVBbXCJGcm9tXCJdLmFkZHJlc3MudXJpLnVzZXIgIT0gbnVsbCkge1xuXG4gICAgICAgICAgc2Vzc2lvbi5zX2Zyb20gPSBzZXNzaW9uLnNfSW5pdGlhbEludml0ZS5TSVBbXCJGcm9tXCJdLmFkZHJlc3MudXJpLnVzZXI7ICBcblxuICAgICAgICAgfSAgICBcbiAgICAgICB9XG4gICAgfVxuXG4gICAgaWYoc2Vzc2lvbi5zX0luaXRpYWxJbnZpdGUuU0lQW1wiUHJpdmFjeVwiXSAhPSBudWxsKSB7XG5cbiAgICAgICAgaWYgKHNlc3Npb24uc19Jbml0aWFsSW52aXRlLlNJUFtcIlByaXZhY3lcIl0udmFsdWUgIT0gbnVsbCkge1xuXG4gICAgICAgICAgICBzZXNzaW9uLnNfcHJpdmFjeSA9IHNlc3Npb24uc19Jbml0aWFsSW52aXRlLlNJUFtcIlByaXZhY3lcIl0udmFsdWU7XG5cbiAgICAgICAgfSBcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcblxuICAgIH0gY2F0Y2ggKGUpIHtcblxuICAgICAgICByZXR1cm4gXCJFcnJvclwiO1xuXG4gICAgfVxufVxuIl19